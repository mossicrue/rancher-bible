# INSTALL RANCHER WITH DOCKER
Rancher offers 2 method of installations:
- sanbox: 1 single docker container for everything
- kuberentes: rancher is installed into a kubernetes cluster

Sandbox installations are simple and clean, great for lab and development environment or demonstration of software and every case where Rancher is standed-up, used and teared down.
Currently there are no way to migrate from one installation to the other, but if you want to start a lab environment that you think can be migrated to a production environment the best options is the kubernetes installation but with only one node.

## Install Rancher with Docker
On a host with Docker run this command

```
docker run -d --restart=unless-stopped -p 80:80 -p 443:443 rancher/rancher:v2.4.13
```

* -d is to daemonize
* -p 80:80 and -p 443:443 is to pass through port 80 and 443
* --restart=unless-stopped - you want this because the backup and upgrade processes require stopping the container. If you use always then you won't ever be able to stop it. You'll have to kill it, and then you can't restart it.

## Secure connections
There are 4 ways to secure rancher communications:
- Rancher generated its self-signed certificate, default option and doesn't require anything externally
- BYO (Bring Your Own) Self-Signed Cert

### BYO Self-Signed Certificates
To use your self-signed cert, you have to attach the certificate files as docker volume
You need 3 files: the private key, full-chain certificate and the CA cert
```
docker run -d --restart=unless-stopped \
-p 80:80 -p 443:443 \
-v /home/ubuntu/certs/server.crt:/etc/rancher/ssl/cert.pem \
-v /home/ubuntu/certs/server.key:/etc/rancher/ssl/key.pem \
-v /home/ubuntu/certs/ca.crt:/etc/rancher/ssl/cacerts.pem \
rancher/rancher:v2.4.13
```

### BYO Real Certificates
To use real certificates, like for public enviroment, you have to do like the BYO Self-Signed Certificates method but you have to pass as docker volume only the private key and the full-chain certificate.
The Ca cert that Rancher will use will be the one shipped by default in the container.
```
docker run -d --restart=unless-stopped \
-p 80:80 -p 443:443 \
-v /home/ubuntu/certs/server.crt:/etc/rancher/ssl/cert.pem \
-v /home/ubuntu/certs/server.key:/etc/rancher/ssl/key.pem \
rancher/rancher:v2.4.13
```

### Autogenerated by Let's Encrypt
Rancher can also request a certificates from Let's Encrypt using the http-01 challenge format.
This works where Rancher can be reached on the internet directly or through port forwarding or public-facing loadbalancer.
The Rancher server must have a DNS name that points to the IP of the Rancher server host, and it must be reachable on port 80.
**NOTE**: The challenge can come from anywhere, so port 80 has to be open to the world.

```
docker run -d --restart=unless-stopped \
-p 80:80 -p 443:443 rancher/rancher:v2.4.13 \
--acme-domain rancher.mydomain.com
```

**NOTE**: `--acme-domain rancher.mydomain.com` isn't a docker args but a container args that will be appended to the docker entrypoint.

## Bind Volume for Rancher persistent data
Rancher creates a Docker volume for its persistent data and mounts it at `/var/lib/rancher` inside of the container.
If you prefer, you can bind-mount a directory from the host to this location instead. By using a bind-mounted directory, backups and restores are easier than when using the Docker volume.
```
docker run -d --restart=unless-stopped -p 80:80 -p 443:443 \
-v /opt/rancher:/var/lib/rancher rancher/rancher:v2.4.13
```
